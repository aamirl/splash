var sellerImages={};Dropzone.autoDiscover=!1,$("#sellerImages").dropzone(Sellyx.dz.init({url:"/corporate/master/inventories"}));var sellerUpload=Dropzone.forElement("#sellerImages");$(document).on("ready",function(){var a=s_lang.manager_corporate_inventories,b=$("#inventoryTable").data("corporate")?!0:!1,c=$("#inventoryTable").data("approvals")?!0:!1,d=b?10:9,e={columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle child-details-control"></i>',"class":"center"},{title:a.tables.active.columns.listing,data:"id","class":"center",render:function(a,b,c){var d='<a href="/world/product/'+c.product.id+"?&listing="+a+'" onclick="event.stopImmediatePropagation();" target="_blank">'+a+"</a>";return c.product.images.label&&(d+='<br /><br /><img src="'+c.product.images.data[c.combo[c.product.images.label].data][0].small+'"></img>'),d}},{title:a.tables.active.columns.seller,data:"seller","class":"center",render:function(a){return'<a href="/world/seller/'+a.id+'" target="_blank"  onclick="event.stopImmediatePropagation();">'+a.name+"</a>"}},{title:a.tables.active.columns.condition,data:"condition.label","class":"center"},{title:a.tables.active.columns.price,data:"pricing","class":"center",render:function(b){var c="";return $.each(b,function(b,d){c+="<label>"+a.text.pricing[b]+"</label><span> "+d.label+"</span><br/>"}),c}},{title:a.tables.active.columns.quantity,data:"quantity","class":"center"},{title:a.tables.active.columns.shipping,data:"shipping_rates.label","class":"center"},{title:a.tables.active.columns.shown,data:"reach.label","class":"center"},{title:a.tables.active.columns.fulfillment,data:"fulfillment","class":"center",render:function(a,b,c){var d="";return(1==c.reach.id||3==c.reach.id)&&(d+=2==a.id?'<img src="/dist/css/img/sellyxfulfillment_small.png" style="max-width:150px;"></img><br />':"<span>Domestically "+a.label+"</span><br/>"),(2==c.reach.id||3==c.reach.id)&&(d+=2==c.sellyxship.id?'<img src="/dist/css/img/sellyxship_small.png" style="max-width:150px;"></img><br />':"<span>"+c.sellyxship.label+"</span><br/>"),d}},{title:a.tables.active.columns.actions,data:"setup","class":"center",render:function(a,c,d){var e={status:a.status.label,buttons:[],go:[1],id:a.status.id};return 1==a.status.id?e.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/inventories/" data-status="'+(b?0:2)+'" data-merge="true" data-extra="'+d.product.id+'"><i class="fa fa-minus-circle"></i> Deactivate Listing</a>'):(2==a.status.id||b&&0==a.status.id)&&e.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/inventories/"  data-merge="true" data-status="1" data-extra="'+d.product.id+'"><i class="fa fa-plus-circle"></i> Reactivate Listing</a>'),e.buttons.push('<a class="clickable edit-listing-button"><i class="fa fa-edit"></i> Edit Listing</a>'),Sellyx.dt.actions(e)}},{title:a.tables.active.columns.id,data:"product.id","class":"center"}],columnDefs:[{visible:!1,targets:d}],drawCallback:function(){var a=this.api(),b=a.rows().nodes(),c=null,e=a.rows()[0];a.column(d).data().each(function(f,g){if(c!=f){var h=a.row(e[g]).data(),i='<tr class="group"><td class="center"><i class="fa fa-lg fa-plus-square product-details-control"></i></td><td colspan="2" class="center">'+(h.product.images.label?"<span>No General Product Image</span>":'<img src="'+h.product.images.data[0].small+'"></img>')+'</td><td colspan="'+(d-5)+'"><span>'+h.product.id+"</span><br/><br/><span> "+h.product.category.label+'</span><br/><a target="_blank" href="/world/product/'+h.product.id+"?&listing="+h.id+'" style="font-size:12px;" onclick="event.stopImmediatePropagation();">'+(h.product.manufacturer?h.product.manufacturer.data.name:"")+" "+h.product.line.data.name+" "+h.product.name.data+'</a></td><td colspan="3" style="text-align:center;">'+(2==h.product.setup.status.id?'<i class="fa fa-lg fa-check s-green"></i>':'<i class="fa fa-ban fa-lg s-red"></i>')+"<span> "+h.product.setup.status.label+"</span></td></tr>";$(b).eq(g).before(i),c=f}})},order:[[2,"desc"]],ajax:{url:"/corporate/master/inventories/inventories",data:function(a){b&&(a.corporate=!0),c&&(a.approvals=!0)},dataSrc:function(a){var b=[];return $.each(a,function(a,c){$.each(c.sellers.data,function(a,d){d.product={name:c.name,description:c.description,setup:c.setup.data,line:c.line,manufacturer:c.manufacturer,images:c.images,category:c.category,id:c.id},c.manufacturer?d.product.manufacturer=c.manufacturer:null,d.combo=c.combos.data[d.combo],b.push(d)})}),b}}};b?null:e.columns.splice(2,1);var f=$("#inventoryTable").dataTable(Sellyx.dt.init(e)),g=null;$(document).on("click","#inventoryTable tbody > tr.group",function(a){a.stopImmediatePropagation();var b=f.DataTable().order()[0];b[0]==d&&"asc"==b[1]?f.DataTable().order([d,"desc"]).draw():f.DataTable().order([d,"asc"]).draw()}).on("click",".edit-listing-button",function(a){a.stopImmediatePropagation(),$.blockUI({message:"Loading Listing Information..."});var b=Sellyx.row.data($(this));g=b,Sellyx.values.set({divs:$("#inventoryModal"),html:"data-var",data:b.data}),sellerImages=Sellyx.images.set({images:b.data.images,target:{html:$("#sellerImages"),dz:sellerUpload}}),2==$("#shipping_rates").val()&&b.data.custom_shipping?$.each(b.data.custom_shipping,function(a,b){var c=$('.shipping-group[service="'+a+'"]');checkbox=c.find(".enable-shipping"),checkbox.trigger("click");var d=c.find("input:text");d[0].value=b.single,d[1].value=b.with,b.exceptions&&$.each(b.exceptions,function(a,b){c.find(".shipping-exceptions").trigger("click");var d=c.find(".shipping-exception:first"),e=d.find("input,select");e[0].value=a,e[1].value=b.single,e[2].value=b.with})}):($("#rates_div input").val(""),$("#rates_div .enable-shipping").prop("checked",!1).trigger("change")),$.unblockUI(),$("#inventoryModal .nav-tabs a:first").tab("show"),$("#inventoryModal").modal("show")}).on("click","#inventoryTable tbody > tr.odd , #inventoryTable tbody > tr.even",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this)),c='<div class="form-horizontal col-sm-'+(b.data.images.length>0?4:6)+'">'+Sellyx.factory.quick().displays({data:b.data.combo,l:5,v:7})+"</div>";c+='<div class="col-sm-'+(b.data.images.length>0?4:6)+'"><label>Added</label><br/><span>'+b.data.setup.added.label+"</span><br/><label>Listed </label><br/><span> "+b.data.reach.label+"</span><br/><span>"+b.data.negotiations.label+"</span><br /><br /><label>Processed In </label><br /><span>"+b.data.process_time.label+"</span></div>",b.data.images.length>0&&(c+='<div class="col-sm-4"><span>Your Product Images</span><br/><br/>',$.each(b.data.images,function(a,b){c+='<img src="'+b.small+'"></img>'}),c+="</div>"),Sellyx.dt.child({all:b,ins:c})}).on("click",".product-details-control",function(a){a.stopImmediatePropagation();var b=$(this).parents("tr");if(b.hasClass("open"))b.find(".product-details-control").addClass("fa-plus-square").removeClass("fa-minus-square"),b.next("tr").remove(),b.removeClass("open");else{var c=Sellyx.row.data(b.next("tr")).data;$('<tr class="form-horizontal"><td colspan="8"><span>'+c.product.line.data.description+"</span><br/><br/><span>"+c.product.description+"</span></td></tr>").insertAfter(b),b.addClass("open"),b.find(".product-details-control").removeClass("fa-plus-square").addClass("fa-minus-square")}}).on("click","#inventoryModal .save-button",function(){var a="&product="+g.data.product.id+"&id="+g.data.id+Sellyx.images.get(sellerImages);if(2==$("#shipping_rates").val()){if((1==$("#reach").val()||3==$("#reach").val())&&0==$("#domestic_custom_rates .enable-shipping:checked").length)return alertify.alert("Please pick at least one service for your domestic customers."),!1;if((2==$("#reach").val()||3==$("#reach").val())&&0==$("#international_custom_rates .enable-shipping:checked").length)return alertify.alert("Please pick at least one service for your international customers."),!1;var b={};$(".shipping-group .enable-shipping:checked").each(function(){var a=$(this).parent(".input-group-addon").siblings("input"),c=$(this).parents(".shipping-group"),d=c.attr("service");b[d]={single:a[0].value,"with":a[1].value};var e=c.find(".shipping-exception");e.length>0&&(b[d].exceptions={},$.each(e,function(){var a=$(this).find(".form-control");b[d].exceptions[a[0].value]={single:a[1].value,"with":a[2].value}}))}),a+="&custom_shipping="+JSON.stringify(b)}Sellyx.ajax.standard({container:{divs:$("#inventoryModal"),html:"data-var"},data:a,url:"/corporate/master/inventories/update",modal:$("#inventoryModal"),update:{row:g.row,merge:!0,child:!0}})})});