var active=null;$(document).on("ready",function(){{var a=s_lang.manager_corporate_listings,b=$("#listingTable").data("corporate")?!0:!1,c=$("#listingTable").data("approvals")?!0:!1;$("#listingTable").DataTable(Sellyx.dt.init({columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle child-details-control"></i>',"class":"center"},{orderable:!1,data:"images","class":"center",render:function(a,b,c){return a&&0!=a.length?'<img src="'+a[0].small+'"></img>':c.world?"<span>Add World Images For This Listing</span>":"<span>Add Images Now</span>"}},{title:a.tables.active.columns.added,data:"setup.added","class":"center",render:function(a,b){return"display"==b?a.label:a.id}},{title:a.tables.active.columns.by,data:"price","class":"center",render:function(a,b,c){return c.seller?"<span>"+c.seller.name+"</span>":"<span>"+c.user.name+"</span>"}},{title:a.tables.active.columns.interests,data:"interests","class":"center",render:function(a){return a.length>0?a.length:"<span>No Interests</span>"}},{title:a.tables.active.columns.title,data:"title","class":"center",render:function(a,b,c){return(c.condition?'<span class="s-d-blue">'+c.condition.label+"</span><br />":"")+"<label>"+c.type.label+"</label><br /><span>"+a+"</span>"}},{title:a.tables.active.columns.price,"class":"center",render:function(a,b,c){return"display"==b?c.price?c.price.label+(c.p_type?"<br/>"+c.p_type.label:""):"No Salary":c.price?c.price.id:0}},{title:a.tables.active.columns.actions,data:"setup.status","class":"center",render:function(a,c,d){if("display"==c){var e={status:a.label+(d.world?' | <b class="s-d-red">Synced</b>':""),buttons:[],go:[1],id:a.id};return 3==a.id?'<i class=" s-d-blue fa fa-fw fa-thumbs-up"></i><span style="font-weight:bold;text-transform:uppercase;" class="s-d-red"> '+a.label+"</span>":b||0!=a.id?(1==a.id?e.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/listings/" data-status="'+(b?0:2)+'" data-merge="true"><i class="fa fa-minus-circle"></i> Deactivate Listing</a><a class="clickable change-status-button" data-path="/corporate/master/listings/"  data-status="3" data-merge="true"><i class="fa fa-minus-circle"></i> Listing Sold!</a>'):(2==a.id||b&&0==a.id)&&e.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/listings/" data-merge="true" data-status="1"><i class="fa fa-plus-circle"></i> Reactivate Listing</a>'),e.buttons.push('<a class="clickable edit-listing-button"><i class="fa fa-edit"></i> Edit Listing</a>'),Sellyx.dt.actions(e)):'<i class=" s-d-red fa fa-fw fa-ban"></i><span> '+a.label+"</span>"}return a.id}}],ajax:{url:"/corporate/master/listings/listings",data:function(a){b&&(a.corporate=!0),c&&(a.approvals=!0)}},rowCallback:function(a,b){3==b.type.id&&$(a).find(".child-details-control").remove()}}))}$(document).on("click","#listingTable tbody > tr.odd , #listingTable tbody > tr.even",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this));active=b;var c=b.data;if(3!=c.type.id){var d='<div class="col-sm-6"><h6>Description</h6><span>'+c.description+"</span><h6>Images</h6>";if(c.images.length>0){var e=Sellyx.images.colorbox.set({small:!0,data:c.images});d+='<div class="row-images">'+e.str+"</div>"}else d+="<span>No Listing Images</span>";d+='</div><div class="col-sm-6"><h6>Details</h6>',d+=4==c.type.id||5==c.type.id?"<span>"+c.htype.label+", "+c.square_feet+" Sqft</span><br /><span>"+c.rooms.label+" Rooms</span><br /><span>"+c.bathrooms_f.label+" Full Bathrooms</span><br /><span>"+c.bathrooms_h.label+" Half Bathrooms</span><br /><span>Pets "+c.pets.label+"</span><br />":6==c.type.id||7==c.type.id||8==c.type.id?"<label>Company</label><span> "+c.company+"</span><br /><label>Job Title</label><span> "+c.jtitle+"</span><br /><label>Experience</label><span> "+c.experience.label+"</span><br />":"<span>"+c.category.label+", </span><span>"+(c.quantity?c.quantity+" Offered, ":"")+c.condition.label+"</span><br />"+(c.p_type?'<i class="fa fa-money s-d-green"></i><span> Price '+c.p_type.label+"</span>":"")+(c.delivery?'<br /><i class="fa fa-truck s-d-blue"></i><span> '+c.delivery.value.label+"</span>"+(c.delivery.extra?'<span class="s-d-red"> '+c.delivery.extra.label+"</span>":""):""),d+="</div>",b.data.interests.length>0&&(d+='<div class="col-sm-12"><h6>Interests</h6><table class="table"><thead style="color:black;"><tr><th>User</th><th>Price</th><th>Location</th><th>Contact</th><th>Last Message</th><th>Action</th></tr></thead><tbody>',$.each(b.data.interests,function(a,b){d+='<tr data-index="'+a+'"><td><a href="/world/user/'+b.user.id+'" target="_blank">'+b.user.name+"</a></td><td>"+b.price.label+"</td><td>"+b.location.city+"</td><td>"+b.contact.label+" "+(b.method?b.method:"")+"</td><td>"+(b.messages.length>0?"<span>"+b.messages[b.messages.length-1].message+'</span><br /><a class="clickable show-messages-button">Show All Messages</a>':'</span>No Messages Exchanged<span><br /><a class="clickable show-messages-button">Send Message</a>')+"</td><td>"+b.setup.status.label+"</td></tr>"}),d+="</tbody></table></div>"),Sellyx.dt.child({all:b,ins:d}),e&&Sellyx.images.colorbox.activate(e.num)}}).on("click","tr .edit-listing-button",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this));active=b,d(b.data.world);var c=b.data.location.city+", "+b.data.location.region.code+", "+b.data.location.country.code;c!=$(".current-location .form-display").text()?($(".current-location").hide(),$(".edit-location").find(".form-display").text(c).end().show()):($(".current-location").show(),$(".edit-location").hide()),$("#listingModal").data("id",b.data.id),$("#listingModal .modal-title").text("Edit Listing"),$("#listingModal .edit-listing-button").show(),$("#listingModal .add-listing-button").hide(),$("#listingModal").modal("show")}).on("click","#disable_sync",function(){d(!$(this).prop("checked"),!0)}).on("click","#listingModal .edit-listing-button",function(){Sellyx.ajax.standard({url:"/corporate/master/listings/edit",data:Sellyx.images.get(listingImages)+"&id="+active.data.id+($("#update_location").prop("checked")?"&location=true":"")+(active.data.world&&$("#disable_sync").prop("checked")?"&sync=off":""),button:$(this),container:{divs:$("#listingModal"),html:"data-var"},update:{row:active.row}})});var d=function(a,b){var c={divs:$("#listingModal"),data:active.data,html:"data-var",match:".form-control"};a?($("#listingImages").hide(),listingUpload.disable(),$("#synced_with").show(),$("#synced_html").attr("href","/world/product/"+active.data.world.product+"?&listing="+active.data.world.listing),c.locked="description|price|category|condition|type|quantity",active.data.images&&active.data.images.length>0?(Sellyx.images.colorbox.set({container:$("#static_images"),data:active.data.images,remove:!0,randomize:!0,small:!0}),$("#static_images").show()):(document.getElementById("static_images").innerHTML="",$("#static_images").hide())):(b||($("#synced_with").hide(),$("#synced_with .form-control").prop("checked",!1)),delete c.locked,listingUpload.enable(),$("#listingImages").show(),document.getElementById("static_images").innerHTML="",$("#static_images").hide(),listingImages=Sellyx.images.set({images:b?[]:active.data.images,target:{html:$("#listingImages"),dz:listingUpload}})),Sellyx.values.set(c),setTimeout(function(){$("#listingModal").data("bs.modal").handleUpdate()},80)}});