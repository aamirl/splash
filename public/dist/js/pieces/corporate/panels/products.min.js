var productImages={};Dropzone.autoDiscover=!1,$("#productImages").dropzone(Sellyx.dz.init({url:"/corporate/master/products"}));var productUpload=Dropzone.forElement("#productImages");$(document).on("ready",function(){var a=s_lang.manager_corporate_products,b=5,c=$("#productTable").data("corporate")?!0:!1,d=$("#productTable").data("approvals")?!0:!1,e=$("#productTable").dataTable(Sellyx.dt.init({columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle product-details-control"></i>',"class":"center"},{data:"images","class":"center",render:function(a){return a.label?"<span>No General Product Images</span>":'<img src="'+a.data[0].small+'"></img>'}},{title:a.tables.active.columns.name,data:"name.data","class":"center"},{title:a.tables.active.columns.added,data:"setup.data.added.label","class":"center"},{title:a.tables.active.columns.actions,data:"setup.data","class":"center",render:function(a){if(!c&&1==a.locked)return"<span>"+a.status.label+"</span>";var b={status:a.status.label,buttons:[],go:[2],id:a.status.id};return 2==a.status.id?b.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/products/" data-status="'+(c?0:3)+'"><i class="fa fa-minus-circle"></i> Deactivate Product</a>'):c&&1==a.status.id?b.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/products/" data-status="2"><i class="fa fa-plus-circle"></i> Activate Product</a>'):(3==a.status.id||c&&0==a.status.id)&&b.buttons.push('<a class="clickable change-status-button" data-path="/corporate/master/products/" data-status="2"><i class="fa fa-plus-circle"></i> Reactivate Product</a>'),(0==a.locked||c)&&b.buttons.push('<a class="clickable edit-variation-button"><i class="fa fa-edit"></i> Edit Variation</a>'),c&&(b.buttons.push("divider"),b.buttons.push(0==a.locked?'<a class="clickable change-status-button" data-status="1" data-extra="locked"><i class="fa fa-lock"></i> Lock</a>':'<a class="clickable change-status-button" data-status="0" data-extra="locked"><i class="fa fa-unlock"></i> Unlock</a>')),Sellyx.dt.actions(b)}},{title:a.tables.active.columns.name,data:"line.id","class":"center"}],columnDefs:[{visible:!1,targets:b}],drawCallback:function(){var a=this.api(),c=a.rows().nodes(),d=null,e=a.rows()[0];a.column(b).data().each(function(b,f){if(d!=b){var g=a.row(e[f]).data(),h='<tr class="group"><td><i class="fa fa-lg fa-plus-square line-details-control"></i></td><td colspan="'+(1==g.line.custom?4:3)+'"><label>'+g.name.label+"(s) For </label><span> "+(g.manufacturer?g.manufacturer.data.name:"")+" "+g.line.data.name+" </span><label>[ "+g.origin.label+" "+g.origin.converted+" ]</label></td>"+(2==g.line.custom?'<td style="text-align:center;">Custom Product</td>':null)+"</tr>";$(c).eq(f).before(h),d=b}})},order:[[2,"desc"]],ajax:{url:"/corporate/master/products/catalog",data:function(a){c&&(a.corporate=!0),d&&(a.approvals=!0)}}})),f=null,g=[];$(document).on("click","#productTable tbody > tr.group",function(a){a.stopImmediatePropagation();var c=e.DataTable().order()[0];c[0]==b&&"asc"==c[1]?e.DataTable().order([b,"desc"]).draw():e.DataTable().order([b,"asc"]).draw()}).on("click",".line-details-control",function(a){a.stopImmediatePropagation();var b=$(this).parents("tr");if(b.hasClass("open"))b.find(".line-details-control").addClass("fa-plus-square").removeClass("fa-minus-square"),b.next("tr").remove(),b.removeClass("open");else{var c=Sellyx.row.data(b.next("tr")).data;$('<tr class="form-horizontal" class="line-details"><td colspan="4"><span>'+c.line.data.description+'</span></td><td colspan="2"><label>Category</label><span> '+c.category.label+"</span></td></tr>").insertAfter(b),b.addClass("open"),b.find(".line-details-control").removeClass("fa-plus-square").addClass("fa-minus-square")}}).on("change","#combination_select",function(){var a=$(this).find("option:selected").data("combo");console.log(a),Sellyx.values.set({divs:$("#combinations_div"),html:"data-var",data:a}),1==a.id?$(".remove-combo-button").prop("disabled",!0).hide():$(".remove-combo-button").prop("disabled",!1).show()}).on("click",".edit-variation-button",function(){var a=Sellyx.row.data($(this));f=a,Sellyx.ajax.standard({url:"/corporate/master/products/form",button:$(this),data:"&id="+a.data.category.id+"&custom="+a.data.line.custom,success:function(b){document.getElementById("product").innerHTML=b.product;var c={name:a.data.name.data,origin:a.data.origin.data};a.data.description&&(c.description=a.data.description),$.extend(c,a.data.attributes.properties),$.extend(c,a.data.attributes.booleans),Sellyx.values.set({divs:$("#product"),html:"data-var",data:c}),"variation"==b.images?(productImages=Sellyx.images.set({images:a.data.images.data,target:{html:$("#productImages"),dz:productUpload}}),$("#combination_image_select").hide()):$("#combination_image_select").show(),document.getElementById("combination_select").innerHTML="",document.getElementById("combinations_div").innerHTML=b.combo,$.each(a.data.combos.data,function(a,b){b.id=a,b.existing=!0;var c=$('<option value="'+a+'">Combination '+a+" [ Existing"+(1==a?", Not Removable":"")+" ]</option>");$("#combination_select").append(c),c.data("combo",b)}),Object.keys(a.data.additional).length>0&&$.each(a.data.additional,function(a,b){$(".additional-attributes").click();var c=$(document).find(".additional-attribute-container:last input");c[0].value=a,c[1].value=b}),$("#productModal").modal("show"),$("#combination_select").val(1).trigger("change")}})}).on("click",".add-combo-button",function(){var a=$(this).hasClass("existing")?$.extend({},$("#combination_select").find("option:selected").data("combo")):{},b=Math.floor(1e6*Math.random());a.id=b,delete a.existing,Sellyx.values.set({data:a,divs:$("#combinations_div"),html:"data-var"});var c=$('<option value="'+b+'">Combination '+b+" [ New ]</option>");$("#combination_select").append(c),c.data("combo",$(this).hasClass("existing")?a:{}),$("#combination_select").val(b).trigger("change")}).on("click",".save-combo-button",function(){var a=$("#combination_select").find("option:selected"),b=Sellyx.values.get({divs:$("#combinations_div"),html:"data-var",json:!0,validate:!0});b&&(b.id=a.attr("value"),a.data("combo",b))}).on("click",".remove-combo-button",function(){var a=$("#combination_select").find("option:selected"),b=a.prev("option").attr("value");return 1==a.attr("value")?(alertify.alert("This combination cannot be removed."),!1):void alertify.confirm("Are you sure you wish to remove this combination?",function(c){if(c){var d=a.data("combo");d.existing&&g.push(d.id),a.remove(),$("#combination_select").val(b).trigger("change")}})}).on("change",".identifier-checkbox",function(){var a=$(this).parents(".input-group-addon").siblings("input");$(this).is(":checked")?a.addClass("validate send").prop("disabled",!1):a.removeClass("validate send").prop("disabled",!0)}).on("click",".additional-attributes",function(){var a=$(this).parent(".buttons-container");$('<div class="form-group additional-attribute-container"><div class="col-xs-2 col-sm-offset-2 col-sm-1"><i class="fa fa-close fa-2x delete-additional-attribute clickable s-d-red" style="margin-top:2px;"></i></div><div class="col-xs-5 col-sm-4"><input type="text" class="form-control validate" placeholder="Enter attribute title here"></div><div class="col-xs-5 col-sm-4"><input type="text" class="form-control validate" placeholder="Enter attribute value here"></div></div>').insertBefore(a)}).on("click",".delete-additional-attribute",function(){$(this).parents(".additional-attribute-container").remove()}).on("click","#productModal .save-button",function(){var a=!1,b={};$.each($("#combination_select").find("option"),function(){var c=$(this).data("combo");return 0==Object.keys(c).length?(a=!0,!1):void(c.existing||(b[c.id]=c))});var c="&combos="+JSON.stringify(b)+"&id="+f.data.id+Sellyx.images.get(productImages)+"&deleted="+g,d=$(".additional-attribute-container");if(d.length>0){var e={};$.each(d,function(){e[$(this).find("input:first").val()]=$(this).find("input:last").val()}),c+="&additional="+JSON.stringify(e)}return a?(alertify.alert("Combination information was not filled out correctly. Please review all submitted information and try again."),!1):void Sellyx.ajax.standard({container:{divs:$("#product"),html:"data-var"},data:c,url:"/corporate/master/products/update",modal:$("#productModal"),update:{row:f.row,merge:!0}})})});