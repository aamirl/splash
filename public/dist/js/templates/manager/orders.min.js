$(document).on("ready",function(){var a=s_lang.manager_orders,b=6,c=$("#orderTable").dataTable(Sellyx.dt.init({columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle child-details-control"></i>',"class":"center"},{title:a.tables.active.columns.placed,data:"order.setup.added","class":"center"},{title:a.tables.active.columns.item,data:"item","class":"center",render:function(a,b,c){return'<a href="/world/product/'+a.id+"?&listing="+c.listing+'" target="_blank" onclick="event.stopImmediatePropagation()">'+a.name+"</a><br />"}},{title:a.tables.active.columns.total,data:"totals.subtotal","class":"center"},{title:a.tables.active.columns.quantity,data:"quantity","class":"center"},{title:a.tables.active.columns.actions,data:"status","class":"center",render:function(a,b,c){var d="<span>"+a.label+"</span>";return 0==c.order.setup.status||3==c.order.setup.status?d:(-1!==$.inArray(a.id,[1,2,3,4,5,12,13])&&(d+='<br /><br /><b style="border:1px solid #DDD; padding: 4px;">'+c.process_time+"</b>",!c.order.promotions&&c.shipping.service&&c.shipping.service.type&&(d+='<br /><a class="clickable">Cancel Item</a>')),d)}},{title:a.tables.active.columns.id,data:"order.id","class":"center",visible:!1}],order:[[b,"asc"],[1,"desc"]],columnDefs:[{visible:!1,targets:b}],drawCallback:function(){var a=this.api(),c=a.rows().nodes(),d=null,e=a.rows()[0];a.column(b).data().each(function(b,f){if(d!=b){var g=a.row(e[f]).data(),h='<tr class="group "><td><i class="fa fa-lg fa-plus-square order-details-control"></i></td><td colspan="2">Order '+g.order.id+' - <a href="/world/seller/'+g.order.seller.id+'" target="_blank" onclick="event.stopImmediatePropagation()">'+g.order.seller.name+'</a></td><td style="text-align:center;"><b class="btn-d-red" style="border:1px solid #ddd;padding:5px;font-size:11px;color:#FFF;">'+g.order.total+'</b></td><td style="text-align:center;">'+(2==g.order.gift?'<i class="fa fa-gift s-creme fa-2x"></i>':"")+'</td><td style="text-align:center;">'+(100==g.order.setup.status.id?'<i class="fa fa-fw fa-check s-l-green"></i>':"")+"<span> "+g.order.setup.status.label+(1==g.order.setup.status.id?' | <a class="clickable cancel-order-button" data-order="'+g.order.id+'">Cancel Order</a>':"")+"</span></td></tr>";$(c).eq(f).before(h),d=b}})},ajax:{path:"orders",dataSrc:function(a){var b=[];return $.each(a,function(a,c){$.each(c.items,function(a,d){d.order={address:c.address,gift:c.gift,id:c.id,payment:c.payment,seller:c.seller,setup:c.setup,total:c.total},b.push(d)})}),b}},rowCallback:function(a,b){switch($(a).addClass("order-row").data("order",b.order.id),b.status.id){case 0:case 18:$(a).addClass("row-error");break;case 6:case 9:case 10:case 11:case 8:$(a).addClass("row-intermediate-success");break;case 14:case 15:case 17:$(a).addClass("row-intermediate-error");break;case 7:case 16:$(a).addClass("row-success");break;default:case 1:case 2:case 3:case 4:case 5:case 12:case 13:break;case 19:$(a).addClass("row-caution")}}}));$(document).on("shown.bs.tab",'a[href="#returns"]',function(){if(!$.fn.DataTable.isDataTable("#returnTable")){$("#returnTable").DataTable(Sellyx.dt.init({columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle return-details-control"></i>',"class":"center"},{title:a.tables.active.columns.placed,data:"setup.added.label","class":"center"},{title:a.tables.active.columns.seller,data:"seller.id","class":"center",render:function(a){return'<a href="/world/seller/'+a.id+'" target="_blank" onclick="event.stopImmediatePropagation()">'+a.name+"</a>"}},{title:a.tables.active.columns.item,data:"item.item","class":"center",render:function(a,b,c){return"<label>Order</label><span> "+c.order+'</span><br /><a href="/world/product/'+a.id+"?&listing="+c.item.listing+'" target="_blank" onclick="event.stopImmediatePropagation()">'+a.name+"</a>"}},{title:a.tables.active.columns.actions,data:"setup.status","class":"center",render:function(a){var b="<span>"+a.label+"</span>";return b}},{title:a.tables.active.columns.id,data:"id","class":"center"}],ajax:"returns",rowCallback:function(a,b){switch($(a).addClass("return-row").data("return",b.id),b.setup.status.id){case 3:$(a).addClass("row-error");break;case 4:case 5:$(a).addClass("row-intermediate-success");break;case 0:case 6:case 7:$(a).addClass("row-intermediate-error");break;case 100:$(a).addClass("row-success")}}}))}}).on("click","#orderTable tbody > tr.group",function(a){a.stopImmediatePropagation();var d=c.DataTable().order()[0];d[0]==b&&"asc"==d[1]?c.DataTable().order([b,"desc"]).draw():c.DataTable().order([b,"asc"]).draw()}).on("click","#orderTable tbody > tr.odd , #orderTable tbody > tr.even",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this)),c="";"sellyx-1"==b.data.shipping.responsibility?c+='<tr><img src="/dist/css/img/sellyxfulfillment_small.png" style="max-width:150px;"></img></tr>':"sellyx-2"==b.data.shipping.responsibility&&(c+='<tr><img src="/dist/css/img/sellyxship_small.png" style="max-width:150px;"></img></tr>'),b.data.shipping.service?c+='<tr><td style="font-weight:100;" colspan="3">Shipping Service</td><td>'+b.data.shipping.service.service.label+'</td><td class="s-d-aqua">'+b.data.shipping.service.rate+"</td>"+(b.data.shipping.type?"":"<td>Grouped Rate</td>")+(b.data.shipping.service.tracking?'<div style="float:right;text-align:right;" class="tracking-div"><label>Tracking</label><br /><span> '+b.data.shipping.service.tracking.id+"</span></br>"+(b.data.shipping.service.tracking.courier?"<span>"+b.data.shipping.service.tracking.courier+"</span><br />":"")+"<span>"+b.data.shipping.service.tracking.added+"</span></div>":""):$.each(b.data.shipping.services,function(a,d){c+='<tr><td style="font-weight:100;" colspan="3">Leg '+a+"<td></tr><tr><td>Shipping Service</td><td>"+d.service.service.label+"</td><td>"+d.service.rate+"</td>"+(d.service.type?"":"<td>Grouped Rate</td>")+(d.service.tracking?'<div style="float:right;text-align:right;" class="tracking-div"><label>Tracking</label><br /><span> '+d.service.tracking.id+"</span></br>"+(b.data.shipping.service.tracking.courier?"<span>"+b.data.shipping.service.tracking.courier+"</span><br />":"")+"<span>"+d.service.tracking.added+"</span></div>":"")}),c+='<td colspan="2"><a class="clickable reorder-item">Reorder Item</a>',b.data.returnable?c+='<br /><br / ><div class="returnable"><span>You can <a class="clickable return-item-button" data-listing="'+b.data.listing+'">return this item</a> before</span><br /><label>'+b.data.returnable+"</label></div>":null,c+='</td></tr><tr class="form-horizontal"><td colspan="6">'+Sellyx.factory.quick().displays({data:b.data.totals,l:5,v:7})+"</td></tr>",Sellyx.dt.child({all:b,ins:c,table:{no_width:!0}})}).on("click",".order-details-control",function(a){a.stopImmediatePropagation();var b=$(this).parents("tr");if(b.hasClass("open"))b.find(".order-details-control").addClass("fa-plus-square").removeClass("fa-minus-square"),b.next("tr").remove(),b.removeClass("open");else{var c=Sellyx.row.data(b.next("tr")).data;$('<tr class="form-horizontal" class="order-details"><td colspan="3"><span>Address</span><br />'+Sellyx.factory.quick().displays({data:c.order.address,l:5,v:7})+"</td></tr>").insertAfter(b),b.addClass("open"),b.find(".order-details-control").removeClass("fa-plus-square").addClass("fa-minus-square")}}).on("click",".cancel-order-button",function(b){b.stopImmediatePropagation(),Sellyx.ajax.standard({url:"cancel",button:$(this),block:$(this).parents("tr"),lang:a.ajax.cancel,data:"&id="+$(this).data("order"),success:function(){setTimeout(function(){$("#orderTable").DataTable().ajax.reload()},1e3)}})}).on("click",".return-item-button",function(){if($(this).hasClass("open"))return $(this).removeClass("open"),void $(this).parents(".returnable").find(".return-box").remove();var a='<div class="return-box" style="margin-top:10px;"><input type="text" class="form-control data-number send validate" placeholder="Quantity" data-var="quantity" /><select class="form-control send validate" data-var="reason"><option value="1">Ordered the wrong item</option><option value="2">Ordered the wrong size</option><option value="3">Item different from what was ordered</option><option value="4">Item was defective or damaged</option><option value="5">Did not like the item</option><option value="6">Do not want the item any longer</option></select><textarea  class="form-control send" placeholder="Additional Explanation (Optional)" data-var="details"></textarea><div class="buttons-container"><button class="return-item-submit-button" data-listing="'+$(this).data("listing")+'">Send</button></div></div>';$(this).addClass("open"),$(this).parents(".returnable").append(a)}).on("click",".return-item-submit-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr").prevAll(".order-row");Sellyx.ajax.standard({url:"return",button:$(this),container:{divs:$(this).parents(".return-box"),html:"data-var"},lang:a.ajax.return,data:"&id="+c.data("order")+"&listing="+$(this).data("listing"),success:function(){setTimeout(function(){$("#orderTable").DataTable().ajax.reload()},500)}})}).on("click","#returnTable tbody > tr.odd , #returnTable tbody > tr.even",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this)),c=b.data,d='<tr><td colspan="2" class="form-horizontal">'+Sellyx.factory.quick().displays({data:c.item.totals,l:5,v:7})+"</td>";d+='<td colspan="2"><div class="padded" style="border:1px solid #DDD;"><span>Returning '+c.quantity+"/"+c.item.quantity+" Total Items</span><br /><span>"+c.reason.label+"</span><br /><label>"+(c.details?c.details:"")+'</label></div><br /><i class="fa fa-user fa-fw s-d-yellow"></i><span> '+c.policy.shipping+'</span><br /><i class="fa fa-fw fa-money s-d-green"></i><span> '+c.policy.type+"</span>"+(c.policy.details?"<br /><br /><label>"+c.policy.details+"</label>":"")+'</td><td colspan="2">',c.processed&&(d+='<span class="s-d-red">'+c.processed.accepted+"</span><span> | "+c.processed.added+"</span><br />"+(c.processed.total?"<label>Refund Amount</label> <span> "+c.processed.total+"</span>":"")+(c.processed.details?"<br /><label>"+c.processed.details+"</label>":"")),3==c.setup.status.id&&(d+='<div class="return-box" style="margin-top:10px;"><h5 style="color:#FFF;">Return Information</h5><input type="text" class="form-control send validate" placeholder="Courier" data-var="courier" /><input type="text" class="form-control send validate" placeholder="Tracking" data-var="tracking" /><textarea style="resize:none;height:75px;" class="form-control send" placeholder="Additional Details (Optional)" data-var="details"></textarea><div class="buttons-container"><button class="get-seller-address-button btn btn-blue"><i class="fa fa-fw fa-building"></i> Get Seller Address</button><button class="confirm-return-button btn btn-green"><i class="fa fa-fw fa-check"></i> Confirm Return Shipment</button></div></div>'),c.shipped&&(d+='<div style="margin-top:10px;"><i class="fa fa-plane fa-fw s-d-blue"></i><span> Shipped via '+c.shipped.courier+" [ "+c.shipped.tracking+" ]</span><br /><span>"+c.shipped.added+"</span>"+(c.shipped.details?"<br /><label>"+c.shipped.details+"</label>":"")+"</div>"),c.received&&(d+='<br /><div style="font-weight:bold;font-size:11px;"><i class="fa fa-fw fa-check-circle s-d-aqua"></i><span> Return Completed | '+c.received.added+"</span>"),Sellyx.dt.child({all:b,ins:d+"</td></tr>",table:!0})}).on("click",".get-seller-address-button",function(a){a.stopImmediatePropagation(),Sellyx.ajax.standard({url:"address",button:$(this),data:"&id="+$(this).parents("tr").prev(".return-row").data("return"),success:function(a){alertify.alert(Sellyx.factory.quick().displays({data:a,l:5,v:7,container:!0}))}})}).on("click",".confirm-return-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr").prev(".return-row");Sellyx.ajax.standard({url:"shipped",button:$(this),container:{divs:$(this).parents(".return-box"),html:"data-var"},lang:a.ajax.process,data:"&id="+c.data("return"),update:{merge:!0,child:!0,row:c}})})});