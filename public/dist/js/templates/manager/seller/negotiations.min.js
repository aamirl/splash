$(document).on("ready",function(){{var a=s_lang.manager_seller_negotiations;$("#negotiationTable").dataTable(Sellyx.dt.init({columns:[{orderable:!1,data:null,defaultContent:'<i class="fa fa-lg fa-plus-circle negotiation-details-control"></i>',"class":"center"},{title:a.tables.active.columns.started,data:"setup.added","class":"center"},{title:a.tables.active.columns.user,data:"user","class":"center",render:function(a){return'<a href="/world/user/'+a.id+'" target="_blank" onclick="event.stopImmediatePropagation()">'+a.name+"</a><br />"}},{title:a.tables.active.columns.item,data:"item","class":"center",render:function(a,b,c){return'<a href="/world/product/'+a.id+"?&listing="+c.listing+'" target="_blank" onclick="event.stopImmediatePropagation()">'+a.name+"</a><br />"}},{title:a.tables.active.columns.actions,data:"setup.status","class":"center",render:function(a,b,c){var d="<span>"+a.label+"</span>";return-1!=$.inArray(a.id,[2,3,100])?d+="<br /><span>"+c.ended+"</span>":1==a.id?d+='<br /><a class="clickable end-negotiation-button">End Negotiations</a>':d}},{title:a.tables.active.columns.id,data:"id","class":"center"}],order:[[2,"desc"]],ajax:"negotiations",rowCallback:function(a,b){switch($(a).addClass("negotiation-row"),$(a).data("negotiation",b.id),b.setup.status.id){case 0:case 2:case 3:$(a).addClass("row-error");break;case 100:$(a).addClass("row-success")}}}))}$(document).on("click",".negotiation-details-control , #negotiationTable tbody > tr.odd , #negotiationTable tbody > tr.even",function(a){a.stopImmediatePropagation();var b=Sellyx.row.data($(this)),c=b.data;if(b.dtrow.child.isShown())b.dtrow.child.hide(),b.row.find(".negotiation-details-control").addClass("fa-plus-circle").removeClass("fa-minus-circle");else{var d='<table class="child-table table" cellpadding="5" cellspacing="0" border="0" style="width:100%;"><thead><tr style="background-color:darkcyan;text-align:center;;"><td>Dates</td><td>Sent By</td><td>Offer Price</td><td>Offer Quantity</td><td>Details</td></tr></thead><tbody>',e=c.offers.length;$.each(c.offers,function(a,b){return d+='<tr data-negotiation="'+c.id+'" class="'+(1==b.status.id?"":5==b.status.id?"row-intermediate-success":"row-intermediate-error")+'" style="text-align:center;"><td><label>Added</label><span> '+b.added+"</span><br /><label>Expiration</label><span> "+b.expiration+"</span>"+(b.rejected?"<br /><label>Rejected</label><span> "+b.rejected+"</span>":"")+(b.cancelled?"<br /><label>Cancelled</label><span> "+b.cancelled+"</span>":"")+"</td><td>"+(2==b.by?"Your Company":"Customer")+"</td><td>"+b.price+"</td><td>"+b.quantity+'</td><td><span class="bordered">'+b.status.label+"</span><br /><br />"+(b.prompt?"<span>"+b.prompt+"</span>":"")+(b.rejection?"<br /><br/><label>Rejected Reason</label><br /><span>"+b.rejection+"</span>":""),-1!==$.inArray(c.setup.status.id,[0,2,3])?d+="</td></tr>":(a+1==e&&(1==b.status.id?1==b.by?d+='<br /><br /><a class="clickable accept-offer-button">Accept Offer</a><br /><a class="clickable send-offer-button">Reject/Send New Offer</a>':2==b.by&&(d+='<br /><br /><a class="clickable send-offer-button">Cancel/Send New Offer</a>'):5==b.status.id&&(d+=b.redemption.redeemed?"<br /><br /><span>Redeemed on</span><br /><label>"+b.redemption.on+"</label>":"<br /><br /><label>Customer has not redeemed offer yet.</label>")),void(d+="</td></tr>"))}),b.row.find(".negotiation-details-control").removeClass("fa-plus-circle").addClass("fa-minus-circle"),b.dtrow.child(d+"</table>").show()}}).on("click",".send-offer-button",function(a){if(a.stopImmediatePropagation(),$(this).hasClass("open"))return $(this).removeClass("open"),void $(this).next(".n-box").remove();var b='<div class="n-box" style="margin-top:10px;"><input type="text" class="form-control data-number send validate" placeholder="Quantity" data-var="quantity" /><input type="text" class="form-control data-decimal send validate" placeholder="Price" data-var="price" /><input type="text" class="form-control send validate" placeholder="Offer Expiration" data-var="expiration" data-date-format="dddd, MMMM Do, YYYY, h:mm A" /><textarea  class="form-control send" placeholder="Additional Details (Optional)" data-var="prompt"></textarea><div class="buttons-container"><button class="submit-offer-button">Send</button></div></div>';$(this).addClass("open"),$(b).insertAfter($(this)),Sellyx.dtime.datetime($(this).next(".n-box").find('input[data-var="expiration"]'))}).on("click",".accept-offer-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr").prevAll(".negotiation-row");Sellyx.ajax.standard({url:"accept",button:$(this),container:{divs:$(this).parents(".n-box"),html:"data-var"},lang:a.ajax.accept,data:"&id="+$(this).parents("tr").data("negotiation"),update:{merge:!0,child:!0,row:c}})}).on("click",".submit-offer-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr").prevAll(".negotiation-row");Sellyx.ajax.standard({url:"submit",button:$(this),container:{divs:$(this).parents(".n-box"),html:"data-var"},lang:a.ajax.submit,data:"&id="+$(this).parents("tr").data("negotiation"),update:{merge:!0,child:!0,row:c}})}).on("click",".end-negotiation-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr");Sellyx.ajax.standard({url:"cancel",button:$(this),lang:a.ajax.cancel,data:"&id="+c.data("negotiation"),update:{merge:!0,row:c}})}).on("click",".redeem-offer-button",function(b){b.stopImmediatePropagation();var c=$(this).parents("tr");Sellyx.ajax.standard({url:"redeem",button:$(this),lang:a.ajax.redeem,data:"&id="+c.data("negotiation")})})});