$(document).on("ready",function(){{var a=s_lang.manager_promotions,b={data:0,row:0};$("#promotionsTable").dataTable(Sellyx.dt.init({columns:[{title:a.tables.general.columns.id,data:"id","class":"center"},{title:a.tables.general.columns.apply,data:"apply.label","class":"center"},{title:a.tables.general.columns.type,data:"type.label","class":"center"},{title:a.tables.general.columns.value,data:"value","class":"center"},{title:a.tables.general.columns.start,data:"start","class":"center"},{title:a.tables.general.columns.end,data:"end","class":"center"},{title:a.tables.general.columns.status,data:"setup.status","class":"center",render:function(a){var b={status:a.label,buttons:[],go:[2],pending:[1],id:a.id};return 1==a.id?b.buttons.push('<a class="clickable change-status-button" data-status="4" data-merge="true"><i class="fa fa-minus-circle"></i> Cancel Scheduled Promotion</a>'):2==a.id&&b.buttons.push('<a class="clickable change-status-button" data-merge="true" data-status="4"><i class="fa fa-minus-circle"></i> Cancel Active Promotion</a>'),b.buttons.push('<a class="clickable edit-promotion-button"><i class="fa fa-edit"></i> '+(1==a.id?"Edit":"View")+" Promotion</a>"),Sellyx.dt.actions(b)}}],ajax:"promotions"}))}$(document).on("click",".add-button",function(){0!=$("#items").children().length?($("#promotionsModal .modal-title").text(a.text.add),Sellyx.reset($("#promotionsModal .modal-dialog")),c(2),$("#promotionsModal").modal("show")):alertify.alert(a.text.no_inventory)}).on("change","#type",function(){var b=($("#promotions_hidden .col-sm-8"),$(this).val());1==b||4==b?$("#value").val("").addClass("data-decimal"):$("#value").val("").removeClass("data-decimal"),$("#value").parent().siblings("label").text($(this).find("option:selected").text()),$("#value").attr("placeholder",a.form.value.placeholder[b])}).on("change","#redemption",function(){2==$(this).val()?($("#promotions_code_hidden").show(),$("#code").addClass("validate send"),$("#conjunction").addClass("send")):($("#promotions_code_hidden").hide(),$("#code").removeClass("validate send"),$("#conjunction").removeClass("send"))}).on("change","#apply",function(){$(".promo-hidden").find(".form-control").removeClass("send validate").end().hide();var a=$("#hidden_"+$(this).val()).show().find(".form-control");a.not("#minimum").addClass("send validate"),2==$(this).val()?($('#type option[value="3"]').prop("disabled",!0),$("#maximum").parents(".form-group").hide()):($("#maximum").parents(".form-group").show(),$('#type option[value="3"]').prop("disabled",!1))}).on("click","#promotionsModal .add-new-button",function(){$this=$(this);var c={url:Sellyx.path.ajax()+"upsert",button:$this,data:"&mod="+$this.data("type"),lang:a.ajax.add,container:$("#promotionsModal")};2==$this.data("type")?(c.data+="&id="+b.data.id,c.lang=a.ajax.edit,c.success=function(a){Sellyx.row.update({data:a,row:b.row,merge:!0})}):c.success=function(a){Sellyx.row.add({data:a,table:$("#promotionsTable")})},Sellyx.ajax.standard(c)}).on("click",".edit-promotion-button",function(){$this=$(this);var d=Sellyx.row.data($this);if(b=d,console.log(b.data),1!=b.data.setup.status.id){var e=!0;$("#promotionsModal .modal-title").text(a.text.details),c(1)}else{var e=!1;$("#promotionsModal .modal-title").text(a.text.edit),c(3)}Sellyx.values.set({locked:e,data:b.data,divs:$("#promotionsModal .modal-dialog")}),$("#promotionsModal").modal("show")}),$("#apply").trigger("change"),$("#type").trigger("change"),Sellyx.dtime.datetime($("#start, #end"));var c=function(b){var c="",d='<button class="btn btn-blue add-new-button" data-type="1">'+a.buttons.add.label+"</button>",e='<button type="button" class="btn btn-black" data-dismiss="modal">'+a.buttons.close.label+"</button>",f='<button class="btn btn-green add-new-button" data-type="2">'+a.buttons.save.label+"</button>";switch(b){case 1:c=e;break;case 2:c=d+e;break;case 3:c=f+e}$("#promotionsModal .modal-footer").children().remove().end().append(c)}});