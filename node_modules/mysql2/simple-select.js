//var ol = console.log;
//console.log = function(p1, p2, p3) { console.trace(); ol(p1, p2, p3); };

var mysql = require('./test/common').createConnection({ multipleStatements: true });

mysql.query('DROP TABLE some_rows');
mysql.query('CREATE TABLE some_rows (test int)');
mysql.query('INSERT INTO some_rows values(0)');
mysql.query('INSERT INTO some_rows values(42)');
mysql.query('INSERT INTO some_rows values(314149)');

var sp = 'DROP PROCEDURE IF EXISTS _as_sp_call;\nCREATE PROCEDURE _as_sp_call()\nBEGIN\nselect * from some_rows;\nEND';
console.log(sp);
mysql.query(sp, function(err, rows, columns, numRes) {
  //console.log('Should be called once!', arguments);
});


mysql.execute("CALL _as_sp_call()", function(err, rows, fields, numRes) {
    console.log(err, numRes);
    console.log('ROWS:', JSON.stringify(rows));
    console.log('FIELDS:', JSON.stringify(fields));


var e = mysql.execute("CALL _as_sp_call()");
e.on('result', function(r, index) {
  console.log("Result:", r, index);
});
e.on('fields', function(f, index) {
  console.log("Fields:", f, index);
});


});
